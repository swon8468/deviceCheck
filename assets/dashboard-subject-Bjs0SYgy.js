import{r as m,u as Is,j as e,B as x,T as c,m as j,n as Ve,o as Be,b as W,z as ue,a8 as ye,a9 as me,d as _,l as ae,D as Ee,p as ve,L as Ke,q as Pe,s as Oe,t as Ge,v as Ue,w as Xe,U as K,V as P,W as O,G as b,F as G,I as U,S as X,M as R,X as Y,e as J,P as Q,f as Z,g as H,h as f,i as t,k as F,c as Ce,A as Ds,aa as Ts}from"./vendor-mui-EHn5RoE1.js";import{u as Ws,a as As,c as C,d as S,g as Ye,l as Je,b as Se,S as V,o as ee,q as se,w as $}from"./dashboard-admin-zNdg3Xgx.js";import"./vendor-react-COd4auuD.js";const Os=()=>{const{currentUser:d,logout:Qe}=Ws(),[z,le]=m.useState(0),[je,we]=m.useState(!0),ge=()=>{we(!je)},[B,Ze]=m.useState([]),[es,ss]=m.useState([]),[ts,rs]=m.useState([]),[N,ns]=m.useState([]),[Rs,is]=m.useState([]),[zs,as]=m.useState([]),[pe,ls]=m.useState([]),[os,te]=m.useState(!0),[ke,fe]=m.useState(null),cs=Is(),{isMobile:oe,isSmallMobile:ce,isLargeDesktop:de,isMobileOrSmaller:ds}=As(),[Ie,w]=m.useState(!1),[De,E]=m.useState(!1),[Ns,qs]=m.useState(!1),[$s,Ls]=m.useState(!1),[g,re]=m.useState(null),[k,hs]=m.useState(null),[Ms,_s]=m.useState(null),[u,p]=m.useState({studentId:"",type:"demerit",reason:"",value:1,description:""}),[h,xs]=m.useState({key:"name",direction:"asc"}),[q,us]=m.useState({key:"className",direction:"asc"}),[L,Te]=m.useState(""),[We,ne]=m.useState(!1),[I,ms]=m.useState(null),[he,Ae]=m.useState([]),y=s=>{xs(i=>({key:s,direction:i.key===s&&i.direction==="asc"?"desc":"asc"}))},be=s=>{us(i=>({key:s,direction:i.key===s&&i.direction==="asc"?"desc":"asc"}))},Re=s=>{Te(s)},ze=()=>{if(!L.trim())return B;const s=L.toLowerCase();return B.filter(i=>i.name.toLowerCase().includes(s)||i.studentId.toLowerCase().includes(s)||`${i.grade}학년 ${i.class}반`.includes(L)||i.homeroomTeacherName&&i.homeroomTeacherName.toLowerCase().includes(s)||i.homeroomTeacher&&i.homeroomTeacher.toLowerCase().includes(s))},js=async s=>{try{const i=C(S,"merit_demerit_records"),a=se(i,$("studentId","==",s)),l=(await Ye(a)).docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate?.()||new Date(n.data().createdAt)})).sort((n,o)=>new Date(o.createdAt)-new Date(n.createdAt));Ae(l)}catch(i){console.error("학생 상벌점 내역 조회 오류:",i),Ae([])}},Ne=async s=>{ms(s),ne(!0),await js(s.id)},[Hs,Fs]=m.useState({title:"",content:"",category:"일반"});m.useEffect(()=>{if(d){let s=null,i=null,a=null,r=null;return(async()=>{try{s=await gs(),i=await qe(),a=await ps(),r=await fs(),await bs();try{await Se(C(S,"system_logs"),{userId:d.uid,userName:d.name||d.email,userRole:d.role,majorCategory:"교사 활동",middleCategory:"대시보드 접근",minorCategory:"",action:"교과목 교사 대시보드 접근",details:`${d.name||d.email}님이 교과목 교사 대시보드에 접근했습니다.`,timestamp:new Date,createdAt:new Date})}catch(n){console.error("시스템 로그 기록 오류:",n)}}catch(n){console.error("리스너 설정 오류:",n),fe(n.message)}})(),ys(),()=>{typeof s=="function"&&s(),typeof i=="function"&&i(),typeof a=="function"&&a(),typeof r=="function"&&r()}}},[d]),m.useEffect(()=>{g&&p(s=>({...s,studentId:g.id}))},[g]);const gs=async()=>{try{const s=C(S,"classes");return ee(s,a=>{const r=[];if(a.forEach(l=>{const n=l.data();n.subjectTeachers&&n.subjectTeachers.includes(d.uid)&&r.push({id:l.id,...n})}),ss(r),r.length>0){const l=C(S,"accounts"),n=r.map(D=>({grade:D.grade,class:D.class})),o=[...new Set(n.map(D=>D.grade))],v=[...new Set(n.map(D=>D.class))],Ss=se(l,$("role","==","student"),$("grade","in",o),$("class","in",v));return ee(Ss,D=>{const He=[];D.forEach(Fe=>{const A=Fe.data();if(r.some(T=>{const xe=T.grade===A.grade,ws=T.class===A.class,ks=T.subjectTeachers&&T.subjectTeachers.includes(d.uid);return xe&&ws&&ks})){const T=r.find(xe=>xe.grade===A.grade&&xe.class===A.class);He.push({id:Fe.id,...A,createdAt:A.createdAt?.toDate?.()||new Date(A.createdAt),className:`${A.grade}학년 ${A.class}반`,homeroomTeacherName:T?.homeroomTeacherName||T?.teacherName,homeroom_teacher:T?.homeroomTeacher||T?.homeroomTeacherId||T?.teacherId})}}),Ze(He),te(!1)},D=>{console.error("학생 실시간 조회 오류:",D),te(!1)})}te(!1)},a=>{console.error("클래스 실시간 조회 오류:",a),te(!1)})}catch(s){return console.error("학생 조회 오류:",s),te(!1),null}},qe=async()=>{try{const s=C(S,"merit_demerit_requests"),i=se(s,$("requestingTeacherId","==",d.uid));return ee(i,r=>{const l=r.docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate?.()||new Date(n.data().createdAt),responseAt:n.data().responseAt?.toDate?.()||(n.data().responseAt?new Date(n.data().responseAt):null)})).sort((n,o)=>new Date(o.createdAt)-new Date(n.createdAt));ns(l)},r=>{console.error("요청 실시간 조회 오류:",r)})}catch(s){return console.error("요청 조회 오류:",s),null}},ps=async()=>{try{const s=C(S,"merit_demerit_records"),i=se(s,$("teacherId","==",d.uid));return ee(i,r=>{const l=r.docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate?.()||new Date(n.data().createdAt)})).sort((n,o)=>new Date(o.createdAt)-new Date(n.createdAt));is(l)},r=>{console.error("상벌점 로그 실시간 조회 오류:",r)})}catch(s){return console.error("상벌점 로그 조회 오류:",s),null}},fs=async()=>{try{const s=C(S,"inquiries"),i=se(s,$("authorId","==",d.id||d.uid));return ee(i,r=>{const l=r.docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate?.()||new Date(n.data().createdAt),updatedAt:n.data().updatedAt?.toDate?.()||new Date(n.data().updatedAt)})).sort((n,o)=>new Date(o.createdAt)-new Date(n.createdAt));as(l)},r=>{console.error("교과목 교사 문의 조회 오류:",r),fe(r.message)})}catch(s){return console.error("교과목 교사 fetchInquiries 오류:",s),fe(s.message),null}},bs=async()=>{try{const s=C(S,"accounts"),i=se(s,$("role","in",["homeroom_teacher","subject_teacher"]));return ee(i,r=>{const l=r.docs.map(n=>({id:n.id,...n.data()}));rs(l)},r=>{console.error("교사 정보 실시간 조회 오류:",r)})}catch(s){console.error("교사 정보 조회 오류:",s)}},ys=async()=>{try{const s=C(S,"merit_reasons"),a=(await Ye(s)).docs.map(r=>({id:r.id,...r.data()}));ls(a)}catch(s){console.error("상벌점 사유 조회 오류:",s)}},M=s=>{if(!s)return"담임교사 없음";const i=ts.find(a=>a.id===s);return i?`${i.name} (${i.email})`:`ID: ${s}`},$e=async()=>{try{await Qe()}catch(s){console.error("로그아웃 오류:",s)}},Le=async()=>{try{if(!u.studentId){await V.fire({title:"오류",text:"학생을 선택해주세요.",icon:"error"});return}if(!u.reason){await V.fire({title:"오류",text:"사유를 선택해주세요.",icon:"error"});return}const s=B.find(o=>o.id===u.studentId);if(!s){await V.fire({title:"오류",text:"선택된 학생 정보를 찾을 수 없습니다.",icon:"error"});return}const i=es.find(o=>o.grade===s.grade&&o.class===s.class);if(!i){await V.fire({title:"오류",text:"학생의 클래스 정보를 찾을 수 없습니다.",icon:"error"});return}const a=i.homeroomTeacherId||i.homeroomTeacher||i.teacherId;if(!a){console.error("클래스 데이터:",i),await V.fire({title:"오류",text:"학생의 담임 교사 ID를 찾을 수 없습니다.",icon:"error"});return}const r=u.type==="demerit"?-Math.abs(u.value):Math.abs(u.value),l={...u,points:r,value:r,requestingTeacherId:d.uid,requestingTeacherName:d.name||d.displayName||d.email,requestingTeacherRole:d.role,requestingTeacherUid:d.uid,requester_id:d.uid,requester_name:d.name||d.displayName||d.email,requester_email:d.email,requester_role:d.role,studentId:s.id,studentName:s.name,studentGrade:s.grade,studentClass:s.class,homeroomTeacherId:a,homeroomTeacherName:i.homeroomTeacherName||i.teacherName||"",status:"pending",date:new Date,createdAt:new Date,updatedAt:new Date},n=await Se(C(S,"merit_demerit_requests"),l);try{await Se(C(S,"system_logs"),{userId:d.uid,userName:d.name||d.email,userRole:d.role,majorCategory:"상벌점 관리",middleCategory:"상벌점 요청",minorCategory:"",action:"상벌점 요청 전송",details:`${d.name||d.email}님이 ${s.name} 학생에게 상벌점 요청을 전송했습니다.`,timestamp:new Date,createdAt:new Date})}catch(o){console.error("로그 기록 오류:",o)}w(!1),p({studentId:"",type:"merit",reason:"",value:1,description:""}),re(null),qe(),await V.fire({title:"성공",text:"상벌점 요청이 성공적으로 전송되었습니다!",icon:"success"})}catch(s){console.error("요청 전송 오류:",s),await V.fire({title:"오류",text:"요청 전송 중 오류가 발생했습니다: "+s.message,icon:"error"})}},ie=s=>s?new Date(s).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",Me=s=>s==="merit"?"success":"error",_e=s=>s==="merit"?e.jsx(Ds,{}):e.jsx(Ts,{}),vs=s=>{switch(s){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";default:return"default"}},Cs=s=>{switch(s){case"pending":return"대기 중";case"approved":return"승인됨";case"rejected":return"거부됨";default:return"알 수 없음"}};return!d||d.role!=="subject_teacher"?null:os?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(c,{variant:"h6",children:"데이터를 불러오는 중..."})}):ke?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:3},children:[e.jsx(c,{variant:"h6",color:"error",gutterBottom:!0,children:"오류가 발생했습니다"}),e.jsx(c,{variant:"body1",color:"text.secondary",align:"center",gutterBottom:!0,children:ke}),e.jsx(j,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"페이지 새로고침"})]}):ds?e.jsxs(x,{sx:{minHeight:"100vh"},children:[e.jsxs(x,{sx:{p:2,display:"flex",alignItems:"center",position:"sticky",top:0,zIndex:1e3},children:[e.jsx(Ve,{onClick:ge,sx:{mr:2},children:e.jsx(Be,{})}),e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",flex:1},children:"교과목 교사 대시보드"})]}),e.jsxs(x,{sx:{p:2,width:"100%",maxWidth:"100%",mx:0},children:[e.jsxs(c,{variant:"h5",sx:{fontWeight:"bold",mb:3,textAlign:"center"},children:[d.name,"선생님 (",d.subject||"과목 미지정",")"]}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:3,justifyContent:"center",width:"100%"},children:[e.jsxs(W,{sx:{flex:1,textAlign:"center",p:2,backgroundColor:"white",boxShadow:2},children:[e.jsx(ue,{sx:{fontSize:32,color:"primary.main",mb:1}}),e.jsx(c,{variant:"h5",sx:{fontWeight:"bold"},children:B.length}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"담당 학생 수"})]}),e.jsxs(W,{sx:{flex:1,textAlign:"center",p:2,backgroundColor:"white",boxShadow:2},children:[e.jsx(ye,{sx:{fontSize:32,color:"info.main",mb:1}}),e.jsx(c,{variant:"h5",sx:{fontWeight:"bold"},children:N.length}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"전송한 요청"})]}),e.jsxs(W,{sx:{flex:1,textAlign:"center",p:2,backgroundColor:"white",boxShadow:2},children:[e.jsx(me,{sx:{fontSize:32,color:"success.main",mb:1}}),e.jsx(c,{variant:"h5",sx:{fontWeight:"bold"},children:N.filter(s=>s.status==="approved").length}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"승인된 요청"})]})]}),e.jsxs(x,{sx:{display:"flex",gap:1,mb:3,width:"100%"},children:[e.jsx(j,{variant:z===0?"contained":"outlined",onClick:()=>le(0),sx:{flex:1},children:"클래스별 학생"}),e.jsx(j,{variant:z===1?"contained":"outlined",onClick:()=>le(1),sx:{flex:1},children:"요청 내역"})]}),z===0&&e.jsxs(x,{sx:{width:"100%"},children:[e.jsx(x,{sx:{mb:2},children:e.jsx(_,{fullWidth:!0,placeholder:"학생명, 학번, 클래스로 검색...",value:L,onChange:s=>Te(s.target.value),sx:{mb:2}})}),(()=>{const s=ze();return s.length===0?e.jsx(W,{sx:{p:3,textAlign:"center"},children:e.jsx(c,{variant:"body1",color:"text.secondary",children:"검색 결과가 없습니다."})}):s.map(i=>e.jsx(W,{sx:{mb:2,p:2},children:e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(x,{children:[e.jsx(c,{variant:"h6",sx:{fontWeight:"bold"},children:i.name}),e.jsxs(c,{variant:"body2",color:"text.secondary",children:[i.studentId," | ",i.grade,"학년 ",i.class,"반"]}),e.jsxs(c,{variant:"body2",color:"text.secondary",children:["담임: ",M(i.homeroomTeacherName||i.homeroom_teacher)]})]}),e.jsx(j,{variant:"contained",size:"small",onClick:()=>{re(i),p({...u,studentId:i.id}),w(!0)},sx:{ml:2},children:"상벌점 요청"})]})},i.id))})()]}),z===1&&e.jsx(x,{sx:{width:"100%"},children:N.length===0?e.jsx(W,{sx:{p:3,textAlign:"center"},children:e.jsx(c,{variant:"body1",color:"text.secondary",children:"전송된 요청이 없습니다."})}):N.map(s=>e.jsxs(W,{sx:{mb:2,p:2},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(c,{variant:"h6",sx:{fontWeight:"bold"},children:s.studentName}),e.jsx(ae,{label:s.status==="pending"?"대기중":s.status==="approved"?"승인됨":"거부됨",color:s.status==="pending"?"warning":s.status==="approved"?"success":"error",size:"small"})]}),e.jsxs(c,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[s.grade,"학년 ",s.class,"반 | ",s.type==="merit"?"상점":"벌점"," ",s.points,"점"]}),e.jsxs(c,{variant:"body2",color:"text.secondary",children:["사유: ",s.reason," | 전송일: ",ie(s.createdAt)]})]},s.id))})]}),e.jsx(Ee,{anchor:"left",open:je,onClose:ge,sx:{"& .MuiDrawer-paper":{width:280,backgroundColor:"#1976d2",color:"white"}},children:e.jsxs(x,{sx:{p:2,textAlign:"center"},children:[e.jsx(x,{sx:{mb:2},children:e.jsx("img",{src:Je,alt:"로고",style:{width:"60px",height:"auto"}})}),e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:"교과목 교사 대시보드"}),e.jsx(c,{variant:"body2",sx:{opacity:.8,mb:3},children:d.name}),e.jsx(ve,{sx:{backgroundColor:"rgba(255,255,255,0.2)",my:2}}),e.jsx(Ke,{sx:{px:1},children:[{text:"클래스별 학생",icon:e.jsx(ue,{}),value:0},{text:"요청 내역",icon:e.jsx(me,{}),value:1}].map(s=>e.jsx(Pe,{disablePadding:!0,children:e.jsxs(Oe,{onClick:()=>{le(s.value),we(!1)},selected:z===s.value,sx:{borderRadius:1,mb:.5,"&.Mui-selected":{backgroundColor:"rgba(255, 255, 255, 0.2)"},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Ge,{sx:{color:"white",minWidth:40},children:s.icon}),e.jsx(Ue,{primary:s.text})]})},s.text))}),e.jsx(ve,{sx:{backgroundColor:"rgba(255,255,255,0.2)",my:2}}),e.jsx(j,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Xe,{}),onClick:$e,sx:{color:"white",borderColor:"white","&:hover":{borderColor:"white",backgroundColor:"rgba(255,255,255,0.1)"}},children:"로그아웃"})]})}),e.jsxs(K,{open:Ie,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"상벌점 요청"}),e.jsx(O,{children:e.jsxs(b,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(b,{item:!0,xs:12,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(U,{children:"학생 선택"}),e.jsx(X,{value:g?g.id:u.studentId,onChange:s=>p({...u,studentId:s.target.value}),label:"학생 선택",children:g&&e.jsxs(R,{value:g.id,children:[g.name," (",g.studentId,") - ",g.grade,"학년 ",g.class,"반"]})})]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(U,{children:"구분"}),e.jsxs(X,{value:u.type,onChange:s=>p({...u,type:s.target.value}),label:"구분",children:[e.jsx(R,{value:"merit",children:"상점"}),e.jsx(R,{value:"demerit",children:"벌점"})]})]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"점수",type:"number",value:u.value,onChange:s=>p({...u,value:parseInt(s.target.value)||1}),inputProps:{min:1,max:10}})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(G,{fullWidth:!0,children:[e.jsx(U,{children:"사유"}),e.jsx(X,{value:u.reason,onChange:s=>p({...u,reason:s.target.value}),label:"사유",children:pe.filter(s=>s.type===u.type).map(s=>e.jsx(R,{value:s.reason,children:s.reason},s.id))})]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"상세 설명",multiline:!0,rows:3,value:u.description,onChange:s=>p({...u,description:s.target.value}),placeholder:"상벌점 부여 사유를 자세히 설명해주세요"})})]})}),e.jsxs(Y,{children:[e.jsx(j,{onClick:()=>w(!1),children:"취소"}),e.jsx(j,{onClick:Le,variant:"contained",children:"요청 전송"})]})]}),e.jsxs(K,{open:De,onClose:()=>E(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:k?`${k.grade}학년 ${k.class}반 학생 목록`:"학생 목록"}),e.jsx(O,{children:k&&e.jsx("div",{className:"table-scroll-container",children:e.jsx(J,{component:Q,children:e.jsxs(Z,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("studentId"),children:["학번 ",h.key==="studentId"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("name"),children:["이름 ",h.key==="name"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("cumulativeScore"),children:["누계 점수 ",h.key==="cumulativeScore"&&(h.direction==="asc"?"↑":"↓")]}),e.jsx(t,{children:"상벌점 내역"}),e.jsx(t,{children:"작업"})]})}),e.jsx(F,{children:[...k.students].sort((s,i)=>{let a=0;const r=s[h.key],l=i[h.key];if(r==null)return 1;if(l==null)return-1;if(h.key==="cumulativeScore"){const n=s.cumulativeScore||0,o=i.cumulativeScore||0;a=n-o}else typeof r=="string"&&typeof l=="string"?a=r.localeCompare(l):a=r-l;return h.direction==="asc"?a:-a}).map(s=>e.jsxs(f,{children:[e.jsx(t,{children:s.studentId}),e.jsx(t,{children:s.name}),e.jsx(t,{children:s.cumulativeScore||0}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"outlined",onClick:()=>Ne(s),children:"내역 보기"})}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"contained",onClick:()=>{re(s),p({...u,studentId:s.id}),w(!0)},children:"상벌점 요청"})})]},s.id))})]})})})}),e.jsx(Y,{children:e.jsx(j,{onClick:()=>E(!1),children:"닫기"})})]}),e.jsxs(K,{open:We,onClose:()=>ne(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:g?`${g.name} 상벌점 내역`:"상벌점 내역"}),e.jsx(O,{children:g&&e.jsx(x,{children:he.length===0?e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(c,{variant:"body1",color:"text.secondary",children:"상벌점 내역이 없습니다."})}):e.jsx(J,{component:Q,children:e.jsxs(Z,{children:[e.jsx(H,{children:e.jsxs(f,{sx:{backgroundColor:"primary.main"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"처리일시"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"구분"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"점수"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"사유"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"처리자"})]})}),e.jsx(F,{children:he.map((s,i)=>e.jsxs(f,{children:[e.jsx(t,{children:ie(s.date)}),e.jsx(t,{children:e.jsx(ae,{label:s.type==="merit"?"상점":"벌점",color:s.type==="merit"?"success":"error",size:"small"})}),e.jsx(t,{children:s.points}),e.jsx(t,{children:s.reason}),e.jsx(t,{children:s.processedBy})]},i))})]})})})}),e.jsx(Y,{children:e.jsx(j,{onClick:()=>ne(!1),children:"닫기"})})]})]}):e.jsxs(x,{sx:{display:"flex",minHeight:"100vh"},children:[e.jsx(Ve,{onClick:ge,sx:{position:"fixed",top:16,left:16,zIndex:1300,backgroundColor:"white",boxShadow:2,display:{xs:"flex",md:"none"},"&:hover":{backgroundColor:"grey.100"}},children:e.jsx(Be,{})}),e.jsxs(Ee,{variant:"permanent",open:je,sx:{width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",backgroundColor:cs.palette.primary.main,color:"white",height:"100vh",display:"flex",flexDirection:"column"}},children:[e.jsxs(x,{sx:{p:3,textAlign:"center"},children:[e.jsx(x,{sx:{mb:2},children:e.jsx("img",{src:Je,alt:"로고",style:{width:"60px",height:"auto"}})}),e.jsx(c,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:"교과목 교사 대시보드"}),e.jsx(c,{variant:"body2",sx:{opacity:.8},children:d.name})]}),e.jsx(ve,{sx:{backgroundColor:"rgba(255,255,255,0.2)"}}),e.jsx(Ke,{sx:{mt:2,flexGrow:1,overflowY:"auto","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255,255,255,0.5)"}},children:[{text:"클래스별 학생",icon:e.jsx(ue,{}),value:0},{text:"요청 내역",icon:e.jsx(me,{}),value:1}].map(s=>e.jsx(Pe,{disablePadding:!0,children:e.jsxs(Oe,{onClick:()=>le(s.value),selected:z===s.value,sx:{"&.Mui-selected":{backgroundColor:"rgba(255,255,255,0.1)"},"&:hover":{backgroundColor:"rgba(255,255,255,0.05)"}},children:[e.jsx(Ge,{sx:{color:"white",minWidth:40},children:s.icon}),e.jsx(Ue,{primary:s.text})]})},s.text))}),e.jsx(x,{sx:{mt:"auto",p:2},children:e.jsx(j,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Xe,{}),onClick:$e,sx:{color:"white",borderColor:"white","&:hover":{borderColor:"white",backgroundColor:"rgba(255,255,255,0.1)"}},children:"로그아웃"})})]}),e.jsxs(x,{sx:{flexGrow:1,overflow:"auto",p:3,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:"100%"},children:[e.jsx(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,width:"100%",maxWidth:"100%"},children:e.jsxs(c,{variant:"h5",component:"h1",sx:{fontWeight:"bold"},children:[d.name,"선생님 (",d.subject||"과목 미지정",")"]})}),e.jsxs(b,{container:!0,spacing:3,sx:{mb:4,width:"100%",maxWidth:"100%"},children:[e.jsx(b,{item:!0,xs:12,sm:4,children:e.jsx(W,{sx:{height:"100%",display:"flex"},children:e.jsxs(Ce,{sx:{textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsx(ue,{sx:{fontSize:40,color:"primary.main",mb:1}}),e.jsx(c,{variant:"h4",children:B.length}),e.jsx(c,{color:"text.secondary",children:"담당 학생 수"})]})})}),e.jsx(b,{item:!0,xs:12,sm:4,children:e.jsx(W,{sx:{height:"100%",display:"flex"},children:e.jsxs(Ce,{sx:{textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsx(ye,{sx:{fontSize:40,color:"info.main",mb:1}}),e.jsx(c,{variant:"h4",children:N.length}),e.jsx(c,{color:"text.secondary",children:"전송한 요청"})]})})}),e.jsx(b,{item:!0,xs:12,sm:4,children:e.jsx(W,{sx:{height:"100%",display:"flex"},children:e.jsxs(Ce,{sx:{textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsx(me,{sx:{fontSize:40,color:"success.main",mb:1}}),e.jsx(c,{variant:"h4",children:N.filter(s=>s.status==="approved").length}),e.jsx(c,{color:"text.secondary",children:"승인된 요청"})]})})})]}),z===0&&e.jsxs(x,{sx:{width:"100%",maxWidth:"100%",minWidth:"100%"},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{label:"학생 검색",variant:"outlined",size:"small",placeholder:"이름, 학번, 클래스로 검색",value:L,onChange:s=>Re(s.target.value),sx:{minWidth:300}}),L&&e.jsx(j,{variant:"outlined",size:"small",onClick:()=>Re(""),sx:{minWidth:"auto",px:2},children:"초기화"})]}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(ye,{}),onClick:()=>{p({studentId:"",type:"demerit",value:1,reason:"",details:""}),w(!0)},size:ce||oe?"small":"medium",children:"상벌점 요청"})]}),e.jsx("div",{className:"table-scroll-container",children:e.jsx(J,{component:Q,children:e.jsx(Z,{children:L.trim()?e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("studentId"),children:["학번 ",h.key==="studentId"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("name"),children:["이름 ",h.key==="name"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("grade"),children:["학년/반/번호 ",h.key==="grade"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("homeroomTeacherName"),children:["담임교사 ",h.key==="homeroomTeacherName"&&(h.direction==="asc"?"↑":"↓")]}),e.jsx(t,{children:"작업"})]})}),e.jsx(F,{children:(()=>{const s=ze();return s.length===0?e.jsx(f,{children:e.jsx(t,{colSpan:5,align:"center",children:"검색 결과가 없습니다."})}):[...s].sort((a,r)=>{let l=0,n,o;switch(h.key){case"studentId":n=a.studentId,o=r.studentId;break;case"name":n=a.name,o=r.name;break;case"grade":n=`${a.grade}학년 ${a.class}반 ${a.number}번`,o=`${r.grade}학년 ${r.class}반 ${r.number}번`;break;case"homeroomTeacherName":n=M(a.homeroomTeacherName||a.homeroomTeacher),o=M(r.homeroomTeacherName||r.homeroomTeacher);break;default:return 0}return n==null?1:o==null?-1:(typeof n=="string"&&typeof o=="string"?l=n.localeCompare(o,"ko-KR"):typeof n=="number"&&typeof o=="number"?l=n-o:l=String(n).localeCompare(String(o),"ko-KR"),h.direction==="asc"?l:-l)}).map(a=>e.jsxs(f,{children:[e.jsx(t,{children:a.studentId}),e.jsx(t,{children:a.name}),e.jsxs(t,{children:[a.grade,"학년 ",a.class,"반 ",a.number,"번"]}),e.jsx(t,{children:M(a.homeroomTeacherName||a.homeroomTeacher)}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"outlined",onClick:()=>{re(a),p({studentId:a.id,type:"demerit",value:1,reason:"",details:""}),w(!0)},children:"상벌점 요청"})})]},a.id))})()})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>be("className"),children:["클래스 ",q.key==="className"&&(q.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>be("studentCount"),children:["학생 수 ",q.key==="studentCount"&&(q.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>be("homeroomTeacher"),children:["담임교사 ",q.key==="homeroomTeacher"&&(q.direction==="asc"?"↑":"↓")]}),e.jsx(t,{children:"작업"})]})}),e.jsx(F,{children:(()=>{const s={};B.forEach(r=>{const l=`${r.grade}학년 ${r.class}반`;s[l]||(s[l]={grade:r.grade,class:r.class,students:[],homeroomTeacher:r.homeroomTeacherName||r.homeroomTeacher}),s[l].students.push(r)});const i=Object.values(s);return i.length===0?e.jsx(f,{children:e.jsx(t,{colSpan:4,align:"center",children:"담당 클래스가 없습니다."})}):[...i].sort((r,l)=>{let n=0,o,v;switch(q.key){case"className":o=`${r.grade}학년 ${r.class}반`,v=`${l.grade}학년 ${l.class}반`;break;case"studentCount":o=r.students.length,v=l.students.length;break;case"homeroomTeacher":o=M(r.homeroomTeacher),v=M(l.homeroomTeacher);break;default:return 0}return o==null?1:v==null?-1:(typeof o=="string"&&typeof v=="string"?n=o.localeCompare(v,"ko-KR"):typeof o=="number"&&typeof v=="number"?n=o-v:n=String(o).localeCompare(String(v),"ko-KR"),q.direction==="asc"?n:-n)}).map((r,l)=>e.jsxs(f,{children:[e.jsx(t,{children:`${r.grade}학년 ${r.class}반`}),e.jsxs(t,{children:[r.students.length,"명"]}),e.jsx(t,{children:M(r.homeroomTeacher)}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"outlined",onClick:()=>{hs(r),E(!0)},children:"학생 보기"})})]},l))})()})]})})})})]}),z===1&&e.jsxs(x,{sx:{width:"100%",maxWidth:"100%",minWidth:"100%"},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(_,{label:"요청 검색",variant:"outlined",size:"small",placeholder:"학생명, 요청 내용으로 검색",sx:{minWidth:300}}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(j,{variant:"outlined",size:ce||oe?"small":"medium",children:"전체"}),e.jsx(j,{variant:"outlined",size:ce||oe?"small":"medium",children:"대기 중"}),e.jsx(j,{variant:"outlined",size:ce||oe?"small":"medium",children:"처리 완료"})]})]}),e.jsx("div",{className:"table-scroll-container",children:e.jsx(J,{component:Q,children:e.jsxs(Z,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsx(t,{children:"전송일시"}),e.jsx(t,{children:"학생"}),e.jsx(t,{children:"구분"}),e.jsx(t,{children:"사유"}),e.jsx(t,{children:"점수"}),e.jsx(t,{children:"상태"}),e.jsx(t,{children:"응답일시"})]})}),e.jsx(F,{children:N.length===0?e.jsx(f,{children:e.jsx(t,{colSpan:7,align:"center",children:"전송한 요청이 없습니다."})}):N.map(s=>e.jsxs(f,{children:[e.jsx(t,{children:ie(s.createdAt)}),e.jsx(t,{children:s.studentName||s.studentId}),e.jsx(t,{children:e.jsx(ae,{icon:_e(s.type),label:s.type==="merit"?"상점":"벌점",color:Me(s.type),size:"small"})}),e.jsx(t,{children:s.reason}),e.jsxs(t,{children:[s.value,"점"]}),e.jsx(t,{children:e.jsx(ae,{label:Cs(s.status),color:vs(s.status),size:"small"})}),e.jsx(t,{children:s.responseAt?ie(s.responseAt):"-"})]},s.id))})]})})})]}),e.jsxs(K,{open:De,onClose:()=>E(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:k?`${k.grade}학년 ${k.class}반 학생 목록`:"학생 목록"}),e.jsx(O,{children:k&&e.jsx("div",{className:"table-scroll-container",children:e.jsx(J,{component:Q,children:e.jsxs(Z,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("studentId"),children:["학번 ",h.key==="studentId"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("name"),children:["이름 ",h.key==="name"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("number"),children:["번호 ",h.key==="number"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("birthDate"),children:["생년월일 ",h.key==="birthDate"&&(h.direction==="asc"?"↑":"↓")]}),e.jsxs(t,{sx:{cursor:"pointer",userSelect:"none"},onClick:()=>y("cumulativeScore"),children:["누계 점수 ",h.key==="cumulativeScore"&&(h.direction==="asc"?"↑":"↓")]}),e.jsx(t,{children:"상벌점 내역"}),e.jsx(t,{children:"작업"})]})}),e.jsx(F,{children:[...k.students].sort((s,i)=>{let a=0;const r=s[h.key],l=i[h.key];if(r==null)return 1;if(l==null)return-1;if(h.key==="cumulativeScore"){const n=s.cumulativeScore||0,o=i.cumulativeScore||0;a=n-o}else typeof r=="string"&&typeof l=="string"?a=r.localeCompare(l,"ko-KR"):typeof r=="number"&&typeof l=="number"?a=r-l:a=String(r).localeCompare(String(l),"ko-KR");return h.direction==="asc"?a:-a}).map(s=>e.jsxs(f,{children:[e.jsx(t,{children:s.studentId}),e.jsx(t,{children:s.name}),e.jsxs(t,{children:[s.number,"번"]}),e.jsx(t,{children:s.birthDate}),e.jsx(t,{children:e.jsxs(c,{variant:"body2",sx:{fontWeight:"bold",color:(s.cumulativeScore||0)>=0?"success.main":"error.main"},children:[s.cumulativeScore||0,"점"]})}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"outlined",onClick:()=>Ne(s),children:"내역 보기"})}),e.jsx(t,{children:e.jsx(j,{size:"small",variant:"outlined",onClick:()=>{re(s),p({studentId:s.id,type:"demerit",value:1,reason:"",details:""}),E(!1),w(!0)},children:"상벌점 요청"})})]},s.id))})]})})})}),e.jsx(Y,{children:e.jsx(j,{onClick:()=>E(!1),children:"닫기"})})]}),e.jsxs(K,{open:Ie,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"상벌점 요청"}),e.jsx(O,{children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1,maxWidth:"500px",mx:"auto"},children:[e.jsxs(G,{fullWidth:!0,children:[e.jsx(U,{children:"학생"}),e.jsx(X,{value:g?g.id:u.studentId,onChange:s=>p({...u,studentId:s.target.value}),label:"학생",size:"medium",children:g&&e.jsxs(R,{value:g.id,children:[g.name," (",g.studentId,") - ",g.grade,"학년 ",g.class,"반"]})})]}),e.jsxs(G,{fullWidth:!0,children:[e.jsx(U,{children:"구분"}),e.jsxs(X,{value:u.type,onChange:s=>p({...u,type:s.target.value}),label:"구분",size:"medium",children:[e.jsx(R,{value:"merit",children:"상점"}),e.jsx(R,{value:"demerit",children:"벌점"})]})]}),e.jsx(_,{fullWidth:!0,label:"점수",type:"number",value:u.value,onChange:s=>p({...u,value:parseInt(s.target.value)}),inputProps:{min:1},required:!0,size:"medium"}),e.jsxs(G,{fullWidth:!0,required:!0,children:[e.jsx(U,{children:"사유"}),e.jsx(X,{value:u.reason,onChange:s=>p({...u,reason:s.target.value}),label:"사유",size:"medium",required:!0,children:u.type==="merit"?pe.filter(s=>s.type==="merit").map(s=>e.jsx(R,{value:s.reason,children:s.reason},s.id)):pe.filter(s=>s.type==="demerit").map(s=>e.jsx(R,{value:s.reason,children:s.reason},s.id))})]}),e.jsx(_,{fullWidth:!0,label:"상세 내용",multiline:!0,rows:3,value:u.description,onChange:s=>p({...u,description:s.target.value}),placeholder:"상벌점을 부여하는 구체적인 이유를 작성해주세요.",size:"medium"})]})}),e.jsxs(Y,{children:[e.jsx(j,{onClick:()=>w(!1),children:"취소"}),e.jsx(j,{onClick:Le,variant:"contained",children:"요청 전송"})]})]}),e.jsxs(K,{open:We,onClose:()=>ne(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(P,{children:I?`${I.name} 학생 상벌점 내역`:"학생 상벌점 내역"}),e.jsx(O,{children:I&&e.jsxs(x,{sx:{mt:2},children:[e.jsxs(x,{sx:{mb:3,p:2,backgroundColor:"#f5f5f5",borderRadius:1},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"학생 정보"}),e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(c,{variant:"body1",children:[e.jsx("strong",{children:"학번:"})," ",I.studentId]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(c,{variant:"body1",children:[e.jsx("strong",{children:"이름:"})," ",I.name]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(c,{variant:"body1",children:[e.jsx("strong",{children:"학년/반/번호:"})," ",I.grade,"학년 ",I.class,"반 ",I.number,"번"]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(c,{variant:"body1",children:[e.jsx("strong",{children:"누계 점수:"}),e.jsxs(c,{component:"span",sx:{fontWeight:"bold",color:(I.cumulativeScore||0)>=0?"success.main":"error.main",ml:1},children:[I.cumulativeScore||0,"점"]})]})})]})]}),e.jsx(c,{variant:"h6",gutterBottom:!0,sx:{mb:2},children:"상벌점 내역"}),he.length===0?e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(c,{variant:"body1",color:"text.secondary",children:"상벌점 내역이 없습니다."})}):e.jsx(J,{component:Q,children:e.jsxs(Z,{children:[e.jsx(H,{children:e.jsxs(f,{sx:{backgroundColor:"primary.main"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"처리일시"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"구분"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"사유"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"점수"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"처리교사"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"상세내용"})]})}),e.jsx(F,{children:he.map(s=>e.jsxs(f,{children:[e.jsx(t,{children:ie(s.createdAt)}),e.jsx(t,{children:e.jsx(ae,{icon:_e(s.type),label:s.type==="merit"?"상점":"벌점",color:Me(s.type),size:"small"})}),e.jsx(t,{children:s.reason}),e.jsx(t,{children:e.jsxs(c,{variant:"body2",sx:{fontWeight:"bold",color:s.type==="merit"?"success.main":"error.main"},children:[s.type==="merit"?"+":"-",s.value,"점"]})}),e.jsx(t,{children:s.teacherName||s.teacherId}),e.jsx(t,{children:e.jsx(c,{variant:"body2",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:s.description||"-"})})]},s.id))})]})})]})}),e.jsx(Y,{children:e.jsx(j,{onClick:()=>ne(!1),children:"닫기"})})]})]})]})};export{Os as default};
